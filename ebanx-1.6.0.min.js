/**
 * EBANX Pay Lib JS for local payments
 * Bundle of @ebanx/lib-js-local
 * Generated: 2020-08-07
 * Version: 1.7.3
 */

/**
 * The MIT License
 *
 * Copyright (c) 2010-current EBANX Pay, https://www.ebanxpay.com/br
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).EBANX=r()}(this,(function(){"use strict";function e(r){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(r)}var r,t,i={"BP-DR-101":"¡Lo sentimos!, vuelva a intentarlo con otra tarjeta.","BP-DR-102":"¡Ups!, algo salió mal, vuelve a intentarlo con otra tarjeta.","BP-DR-76":"País não informado.","BP-DR-77":"País não permitido.","BP-DR-75":"El número de la tarjeta es invalido. Confirma si no hay un error de escritura y vuelva a intentarlo.","BP-DR-S-75":"El bandera de tarjeta de crédito es inválido.","BP-DR-51":"¡Ups!, faltó llenar este campo. Llénalo con el nombre que aparece en tu tarjeta.","BP-DR-55":"El código de tarjeta de crédito es inválido.","BP-DR-57":"Por favor, escribe la fecha en el formato MM/AAAA.","BP-DR-M-57":"El mes de tarjeta de crédito es inválido.","BP-DR-Y-57":"El año de tarjeta de crédito es inválido."},o={"BP-DR-101":"Ops! Esse cartão não está liberado para fazer compras na internet. Entre em contato com o seu banco para mais informações.","BP-DR-102":"Ops, algo deu errado. Tente novamente com outro cartão.","BP-DR-76":"País não informado.","BP-DR-77":"País não permitido.","BP-DR-75":"O número do cartão informado é inválido. Confira se não houve um erro de digitação e tente de novo.","BP-DR-S-75":"A bandeira do cartão de crédito é inválida.","BP-DR-51":"Ei, faltou uma informação aqui! Preencha com o nome que aparece em seu cartão.","BP-DR-55":"O código do cartão de crédito é inválido.","BP-DR-57":"A data do cartão de crédito deve estar no formato mes/ano, por exemplo, 12/2020.","BP-DR-M-57":"O mês data do cartão de crédito é inválido.","BP-DR-Y-57":"O ano data do cartão de crédito é inválido."},n=function(){var e={},r={country:"",mode:"test",publicKey:""};if(e.config={isLive:function(){return"production"===r.mode},setPublishableKey:function(e){r.publicKey=String(e)},setCountry:function(e){n.validator.config.validateCountry(e),r.country=String(e)},setMode:function(e){n.validator.config.validateMode(e),r.mode=e},getMode:function(){return r.mode},getPublishableKey:function(){if(""===r.publicKey.trim())throw new n.errors.InvalidConfigurationError("Missing publishable key. You need set publishable key using the method EBANX.config.setPublishableKey.","publicKey");return r.publicKey},getCountry:function(){return r.country||(r.country="br"),r.country},getLocale:function(){return{br:"pt_BR",mx:"es",co:"es",ar:"es"}[n.config.getCountry()]}},e.config.isLive()&&"https:"!==location.protocol)throw"EBANXInvalidConfigurationError: Your protocol needs to be https.";return e}();return n.errors={summary:{pt_BR:o,es:i},InvalidValueFieldError:function(e,r){this.message=n.errors.summary[n.config.getLocale()][e]||e,this.field=r,this.name="InvalidValueFieldError"},InvalidConfigurationError:function(e,r){this.message=n.errors.summary[n.config.getLocale()][e]||e,this.invalidConfiguration=r,this.name="InvalidConfigurationError"}},n.validator=(r={publicKey:{}},{config:{validatePublishableKey:function(e,t){var i=n.utils.api.resources.validPublicIntegrationKey();r.publicKey[e]?t(r.publicKey[e]):n.http.ajax.request({url:i.url,method:i.method,raw:!0,data:{public_integration_key:e}}).always((function(i){r.publicKey[e]=i,t(i)}))},validateCountry:function(e){if(-1===n.utils.availableCountries.indexOf(e))throw new n.errors.InvalidValueFieldError("BP-DR-77","country")},validateMode:function(e){if(null===e.match(/^(test|production)$/))throw new n.errors.InvalidConfigurationError('Invalid mode, please, use "test" or "production" as test mode.',"mode")}},card:{validateNumber:function(e){if(!this.luhnAlgCheck(String(e)))throw new n.errors.InvalidValueFieldError("BP-DR-75","card_number")},validateName:function(e){if("string"!=typeof e||0===e.length||null!==e.match(/[0-9]+/))throw new n.errors.InvalidValueFieldError("BP-DR-51","card_name")},luhnAlgCheck:function(e){var r,t,i,o;for(i=+e[r=e.length-1],o=0;r--;)t=+e[r],i+=++o%2?2*t%10+(t>4):t;return i%10==0},validateCvv:function(e){var r=new RegExp("^[0-9]{3,4}$");if(!String(e).match(r))throw new n.errors.InvalidValueFieldError("BP-DR-55","card_cvv")},validateDueDate:function(e){var r=(e+"").split("/");if(r={now:new Date,year:r[1],month:r[0]},!0!==/^\d+$/.test(r.month)||parseInt(r.month,10)<=12!=1)throw new n.errors.InvalidValueFieldError("BP-DR-M-57","card_due_date");if(!/^\d+$/.test(r.year))throw new n.errors.InvalidValueFieldError("BP-DR-Y-57","card_due_date");if(r.expiration=new Date(r.year,r.month),r.expiration.setMonth(r.expiration.getMonth()-1),r.expiration.setMonth(r.expiration.getMonth()+1,1),r.expiration>r.now!=1)throw new n.errors.InvalidValueFieldError("BP-DR-57","card_due_date")},validate:function(e){this.validateName(e.card_name),this.validateNumber(e.card_number),this.validateDueDate(e.card_due_date),this.validateCvv(e.card_cvv)}}}),n.tokenize={card:{token:function(e,r,t){var i=n.utils.api.resources.createToken();n.http.ajax.request({url:i.url,method:i.method,data:JSON.stringify({public_integration_key:n.config.getPublishableKey(),payment_type_code:n.utils.creditCardScheme(e.card_number),country:n.config.getCountry(),card:e})}).always((function(e){return"ERROR"!==e.status&&"token"in e?r(e):t(e)}))}}},n.utils=((t={api:{path:function(){return n.config.isLive()?"https://api.ebanx.com.br/":"https://staging.ebanx.com.br/"}},availableCountries:["br","mx","co","ar","pe","cl","ec","bo"].join(", "),creditCardScheme:function(e){n.validator.card.validateNumber(e);var r={br:{aura:/^50[0-9]{14,17}$/,elo:/^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,hipercard:/^(38|60)[0-9]{11,17}$/},mx:{carnet:/^5[0-9][0-9]{14}$/,mastercard__2:/^2[2-7][0-9]{14}$/},co:{diners:/^36[0-9]{12}$/},ar:{mastercard__all:/^[0-9]{16}$/},cl:{magna:/^(568009)/},all:{amex:/^3[47][0-9]{13}$/,mastercard:/^5[1-5][0-9]{14}$/,visa:/^4[0-9]{12}(?:[0-9]{3})?$/}},t={};for(var i in r[n.config.getCountry()])t[i]=r[n.config.getCountry()][i];for(var i in r.all)t[i]=r.all[i];for(var o in t)if(t[o].test(e)){var a=o,s=o.indexOf("__");return-1!==s&&(a=o.substr(0,s)),a}throw new n.errors.InvalidValueFieldError("BP-DR-S-75","card_number")}}).api.url=function(){return t.api.path()+"ws"},t.api.resources={createToken:function(){return{url:t.api.url()+"/token",method:"post"}},validPublicIntegrationKey:function(){return{url:t.api.url()+"/merchantIntegrationProperties/isValidPublicIntegrationKey",method:"get"}},fingerPrintResource:function(){return{url:t.api.path()+"fingerprint/",method:"get"}},fingerPrintProvidersResource:function(){return{url:t.api.path()+"fingerprint/provider",method:"get"}}},t),n.http={normalize:{q:function(r,t){var i=function r(t,i){var o=[];return i=i||[],Object.keys(t).forEach((function(n){if(t.hasOwnProperty(n)){var a=i.slice();a.push(n);var s=[];"object"==e(t[n])?s=r(t[n],a):s.push({path:a,val:t[n]}),s.forEach((function(e){return o.push(e)}))}})),o}(r),o=(i=i.map((function(e){if(1==e.path.length)e.path=e.path[0];else{var r=e.path[0],t=e.path.slice(1);e.path=r+"["+t.join("][")+"]"}return e}))).map((function(e){return e.path+"="+e.val})).join("&");return t?encodeURIComponent(o):o}},ajax:{request:function(e){return"string"==typeof e&&(e={url:e}),e.url=e.url||"",e.method=e.method||"get",e.data=e.data||{},{host:{},process:function(e){var r=this;return this.xhr=null,window.ActiveXObject?this.xhr=new window.ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(this.xhr=new XMLHttpRequest),this.xhr&&(this.xhr.onreadystatechange=function(){var t=r.xhr.responseText||"{}";if(4==r.xhr.readyState){try{void 0===e.raw&&"undefined"!=typeof JSON&&(t=JSON.parse(t))}catch(e){t={}}r.alwaysCallback&&r.alwaysCallback.apply(r.host,[t,r.xhr])}}),"GET"==e.method.toUpperCase()&&(e.url+="?"+n.http.normalize.q(e.data),delete e.data),this.xhr.open(e.method.toUpperCase(),e.url,!0),setTimeout((function(){r.xhr.send(e.data)}),20),this},always:function(e){return this.alwaysCallback=e,this}}.process(e)}},injectJS:function(e,r){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.onload=r,t.src=e,document.getElementsByTagName("head")[0].appendChild(t)}},n.card={createToken:function(e,r){var t={data:{},error:{}},i=function(e){t.data=e,n.deviceFingerprint.setup((function(e){return t.data.deviceId=e,r(t)}),(function(e){return t.data.deviceId="",r(t)}))},o=function(e){return t.error.err=e,r(t)},a="";try{a=n.config.getPublishableKey()}catch(e){t.error.err=e,r(t)}n.validator.config.validatePublishableKey(a,(function(a){var s=JSON.parse(a);if(!s.success)return t.error.err={status:"ERROR",status_code:"",status_message:s.body.error},void r(t);try{n.validator.card.validate(e),n.tokenize.card.token(e,i,o)}catch(e){t.error.err=e,r(t)}}))}},n.deviceFingerprint={ebanxSessionId:null,providerSessionList:[],postProvidersRemaining:0,onSuccessCallback:null,onErrorCallback:null,setup:function(e,r){this.onSuccessCallback=e||console.log,this.onErrorCallback=r||console.error,this.getList(function(e){try{if(!e)throw new Error("EBANX.deviceFingerprint.setup - providersList is missing");if(!e.ebanx_session_id)throw new Error("EBANX.deviceFingerprint.setup - ebanx_session_id is missing");if(!e.providers||!e.providers.length)return this.onSuccessCallback(e.ebanx_session_id);this.ebanxSessionId=e.ebanx_session_id,this.postProvidersRemaining=e.providers.length,e.providers.forEach(function(e){this.loadProvider(e,this.saveProviderSessionList.bind(this))}.bind(this))}catch(e){this.onErrorCallback(e)}}.bind(this))},getList:function(e){n.http.ajax.request({url:n.utils.api.resources.fingerPrintResource().url,data:{publicIntegrationKey:n.config.getPublishableKey(),country:n.config.getCountry()}}).always(e)},saveProviderSessionList:function(e){this.postProvidersRemaining--,this.providerSessionList.push(e),this.postProvidersRemaining||this.postProviderSessionList()},postProviderSessionList:function(){var e=this.ebanxSessionId,r=this.providerSessionList,t=this.onSuccessCallback,i=this.onErrorCallback;this.ebanxSessionId=null,this.providerSessionList=[],this.onSuccessCallback=null,this.onErrorCallback=null;var o={publicIntegrationKey:n.config.getPublishableKey(),ebanx_session_id:e,providers:r},a=n.utils.api.resources.fingerPrintProvidersResource();n.http.ajax.request({url:a.url,method:a.method,data:o}).always((function(r,o){200===o.status?t(e):i(new Error("postProviderSessionList - xhr.status !== 200 - "+o.status))}))},loadProvider:function(e,r){n.http.injectJS(e.source,(function(){n.deviceFingerprint[e.provider].setup(e.settings,(function(t){r({provider:e.provider,session_id:t})}))}))}},n}));
