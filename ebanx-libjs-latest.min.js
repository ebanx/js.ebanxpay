!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("EBANX",[],t):"object"==typeof exports?exports.EBANX=t():e.EBANX=t()}(window,function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=a(r(1)),i=a(r(2));function a(e){return e&&e.__esModule?e:{default:e}}var s,u,d=function(){var e={},t={country:"",mode:"test",publicKey:""};if(e.config={isLive:function(){return"production"===t.mode},setPublishableKey:function(e){t.publicKey=String(e)},setCountry:function(e){d.validator.config.validateCountry(e),t.country=String(e)},setMode:function(e){d.validator.config.validateMode(e),t.mode=e},getMode:function(){return t.mode},getPublishableKey:function(){if(""===t.publicKey.trim())throw new d.errors.InvalidConfigurationError("Missing publishable key. You need set publishable key using the method EBANX.config.setPublishableKey.","publicKey");return t.publicKey},getCountry:function(){return t.country||(t.country="br"),t.country},getLocale:function(){return{br:"pt_BR",mx:"es",co:"es",ar:"es"}[d.config.getCountry()]}},e.config.isLive()&&"https:"!==location.protocol)throw"EBANXInvalidConfigurationError: Your protocol needs to be https.";return e}();d.errors={summary:{pt_BR:i.default,es:n.default},InvalidValueFieldError:function(e,t){this.message=d.errors.summary[d.config.getLocale()][e]||e,this.field=t,this.name="InvalidValueFieldError"},InvalidConfigurationError:function(e,t){this.message=d.errors.summary[d.config.getLocale()][e]||e,this.invalidConfiguration=t,this.name="InvalidConfigurationError"}},d.validator=(s={publicKey:{}},{config:{validatePublishableKey:function(e,t){var r=d.utils.api.resources.validPublicIntegrationKey();s.publicKey[e]?t(s.publicKey[e]):d.http.ajax.request({url:r.url,method:r.method,raw:!0,data:{public_integration_key:e}}).always(function(r){s.publicKey[e]=r,t(r)})},validateCountry:function(e){if(-1===d.utils.availableCountries.indexOf(e))throw new d.errors.InvalidValueFieldError("BP-DR-77","country")},validateMode:function(e){if(null===e.match(/^(test|production)$/))throw new d.errors.InvalidConfigurationError('Invalid mode, please, use "test" or "production" as test mode.',"mode")}},card:{validateNumber:function(e){if(!/^3[47][0-9]{13}$|^50[0-9]{14,17}$|^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)|^3(?:0[0-5]|[68][0-9])[0-9]{11}$|^6(?:011|5[0-9]{2})[0-9]{12}$|^(38|60)[0-9]{11,17}$|^5[1-5][0-9]{14}$|^4[0-9]{12}(?:[0-9]{3})?$/.test(e)||!this.luhnAlgCheck(String(e)))throw new d.errors.InvalidValueFieldError("BP-DR-75","card_number")},validateName:function(e){if("string"!=typeof e||0===e.length||null!==e.match(/[0-9]+/))throw new d.errors.InvalidValueFieldError("BP-DR-51","card_name")},luhnAlgCheck:function(e){var t,r,o,n;for(o=+e[t=e.length-1],n=0;t--;)r=+e[t],o+=++n%2?2*r%10+(r>4):r;return o%10==0},validateCvv:function(e){var t=new RegExp("^[0-9]{3,4}$");if(!String(e).match(t))throw new d.errors.InvalidValueFieldError("BP-DR-55","card_cvv")},validateDueDate:function(e){var t=(e+"").split("/");if(t={now:new Date,year:t[1],month:t[0]},!0!==/^\d+$/.test(t.month)||parseInt(t.month,10)<=12!=1)throw new d.errors.InvalidValueFieldError("BP-DR-M-57","card_due_date");if(!/^\d+$/.test(t.year))throw new d.errors.InvalidValueFieldError("BP-DR-Y-57","card_due_date");if(t.expiration=new Date(t.year,t.month),t.expiration.setMonth(t.expiration.getMonth()-1),t.expiration.setMonth(t.expiration.getMonth()+1,1),t.expiration>t.now!=1)throw new d.errors.InvalidValueFieldError("BP-DR-57","card_due_date")},validate:function(e){this.validateName(e.card_name),this.validateNumber(e.card_number),this.validateDueDate(e.card_due_date),this.validateCvv(e.card_cvv)}}}),d.tokenize={card:{token:function(e,t,r){var o=d.utils.api.resources.createToken();d.http.ajax.request({url:o.url,method:o.method,data:JSON.stringify({public_integration_key:d.config.getPublishableKey(),payment_type_code:d.utils.creditCardScheme(e.card_number),country:d.config.getCountry(),card:e})}).always(function(e){return"ERROR"!==e.status&&"token"in e?t(e):r(e)})}}},d.utils=((u={api:{path:function(){return d.config.isLive()?"https://api.ebanx.com.br/":"https://staging.ebanx.com.br/"}},availableCountries:["br","mx","co","ar"].join(", "),creditCardScheme:function(e){d.validator.card.validateNumber(e);var t={br:{aura:/^50[0-9]{14,17}$/,elo:/^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,hipercard:/^(38|60)[0-9]{11,17}$/},mx:{carnet:/^5[6-9][0-9]{14}$/,mastercard__2:/^2[2-7][0-9]{14}$/},co:{diners:/^36[0-9]{12}$/},ar:{mastercard__all:/^[0-9]{16}$/},all:{amex:/^3[47][0-9]{13}$/,mastercard:/^5[1-5][0-9]{14}$/,visa:/^4[0-9]{12}(?:[0-9]{3})?$/}},r={};for(var o in t[d.config.getCountry()])r[o]=t[d.config.getCountry()][o];for(var o in t.all)r[o]=t.all[o];for(var n in r)if(r[n].test(e)){var i=n,a=n.indexOf("__");return-1!==a&&(i=n.substr(0,a)),i}throw new d.errors.InvalidValueFieldError("BP-DR-S-75","card_number")}}).api.url=function(){return u.api.path()+"ws"},u.api.resources={createToken:function(){return{url:u.api.url()+"/token",method:"post"}},validPublicIntegrationKey:function(){return{url:u.api.url()+"/merchantIntegrationProperties/isValidPublicIntegrationKey",method:"get"}},fingerPrintResource:function(){return{url:u.api.path()+"fingerprint/",method:"get"}},fingerPrintProvidersResource:function(){return{url:u.api.path()+"fingerprint/provider",method:"get"}}},u),d.http={normalize:{q:function(e,t){var r=function e(t,r){var n=[];return r=r||[],Object.keys(t).forEach(function(i){if(t.hasOwnProperty(i)){var a=r.slice();a.push(i);var s=[];"object"==o(t[i])?s=e(t[i],a):s.push({path:a,val:t[i]}),s.forEach(function(e){return n.push(e)})}}),n}(e),n=(r=r.map(function(e){if(1==e.path.length)e.path=e.path[0];else{var t=e.path[0],r=e.path.slice(1);e.path=t+"["+r.join("][")+"]"}return e})).map(function(e){return e.path+"="+e.val}).join("&");return t?encodeURIComponent(n):n}},ajax:{request:function(e){return"string"==typeof e&&(e={url:e}),e.url=e.url||"",e.method=e.method||"get",e.data=e.data||{},{host:{},process:function(e){var t=this;return this.xhr=null,window.ActiveXObject?this.xhr=new window.ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(this.xhr=new XMLHttpRequest),this.xhr&&(this.xhr.onreadystatechange=function(){if(4==t.xhr.readyState){var r=t.xhr.responseText||"{}";void 0===e.raw&&"undefined"!=typeof JSON&&(r=JSON.parse(r)),t.alwaysCallback&&t.alwaysCallback.apply(t.host,[r,t.xhr])}}),"GET"==e.method.toUpperCase()&&(e.url+="?"+d.http.normalize.q(e.data),delete e.data),this.xhr.open(e.method.toUpperCase(),e.url,!0),setTimeout(function(){t.xhr.send(e.data)},20),this},always:function(e){return this.alwaysCallback=e,this}}.process(e)}},injectJS:function(e,t){var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.onload=t,r.src=e,document.getElementsByTagName("head")[0].appendChild(r)}},d.card={createToken:function(e,t){var r={data:{},error:{}},o=function(e){r.data=e,d.deviceFingerprint.setup(function(e){return r.data.deviceId=e,t(r)})},n=function(e){return r.error.err=e,t(r)},i="";try{i=d.config.getPublishableKey()}catch(e){r.error.err=e,t(r)}d.validator.config.validatePublishableKey(i,function(i){var a=JSON.parse(i);if(!a.success)return r.error.err={status:"ERROR",status_code:"",status_message:a.body.error},void t(r);try{d.validator.card.validate(e),d.tokenize.card.token(e,o,n)}catch(e){r.error.err=e,t(r)}})}},d.deviceFingerprint={ebanx_session_id:null,providerSessionList:[],providerPostPending:null,setup:function(e){var t=this;this.getList(function(r){r&&r.ebanx_session_id&&(d.deviceFingerprint.ebanx_session_id=r.ebanx_session_id,e(r.ebanx_session_id),r.providers.forEach(function(e){t.getProviderSessionId(e)}))})},getList:function(e){d.http.ajax.request({url:d.utils.api.resources.fingerPrintResource().url,data:{publicIntegrationKey:d.config.getPublishableKey(),country:d.config.getCountry()}}).always(e)},getProviderSessionId:function(e){this.loadProvider(e,this.saveProviderSessionList)},saveProviderSessionList:function(e){var t=d.deviceFingerprint;t.providerPostPending&&clearTimeout(t.providerPostPending),t.providerSessionList.push(e),t.providerPostPending=setTimeout(t.postProviderSessionList,1e3)},postProviderSessionList:function(){var e=d.deviceFingerprint,t=e.providerSessionList;e.providerSessionList=[],clearTimeout(e.providerPostPending),e.providerPostPending=null;var r={publicIntegrationKey:d.config.getPublishableKey(),ebanx_session_id:e.ebanx_session_id,providers:t},o=d.utils.api.resources.fingerPrintProvidersResource();d.http.ajax.request({url:o.url,method:o.method,data:r})},loadProvider:function(e,t){d.http.injectJS(e.source,function(){d.deviceFingerprint[e.provider].setup(e.settings,function(r){t({provider:e.provider,session_id:r})})})}},e.exports=d},function(e){e.exports={"BP-DR-101":"¡Lo sentimos!, vuelva a intentarlo con otra tarjeta.","BP-DR-102":"¡Ups!, algo salió mal, vuelve a intentarlo con otra tarjeta.","BP-DR-76":"País não informado.","BP-DR-77":"País não permitido.","BP-DR-75":"El número de la tarjeta es invalido. Confirma si no hay un error de escritura y vuelva a intentarlo.","BP-DR-S-75":"El bandera de tarjeta de crédito es inválido.","BP-DR-51":"¡Ups!, faltó llenar este campo. Llénalo con el nombre que aparece en tu tarjeta.","BP-DR-55":"El código de tarjeta de crédito es inválido.","BP-DR-57":"Por favor, escribe la fecha en el formato MM/AAAA.","BP-DR-M-57":"El mes de tarjeta de crédito es inválido.","BP-DR-Y-57":"El año de tarjeta de crédito es inválido."}},function(e){e.exports={"BP-DR-101":"Ops! Esse cartão não está liberado para fazer compras na internet. Entre em contato com o seu banco para mais informações.","BP-DR-102":"Ops, algo deu errado. Tente novamente com outro cartão.","BP-DR-76":"País não informado.","BP-DR-77":"País não permitido.","BP-DR-75":"O número do cartão informado é inválido. Confira se não houve um erro de digitação e tente de novo.","BP-DR-S-75":"A bandeira do cartão de crédito é inválida.","BP-DR-51":"Ei, faltou uma informação aqui! Preencha com o nome que aparece em seu cartão.","BP-DR-55":"O código do cartão de crédito é inválido.","BP-DR-57":"A data do cartão de crédito deve estar no formato mes/ano, por exemplo, 12/2020.","BP-DR-M-57":"O mês data do cartão de crédito é inválido.","BP-DR-Y-57":"O ano data do cartão de crédito é inválido."}}])});